// Examining yearly average temperatures using MODIS satellite imagery at 1km resolution
// This code is for use in Google Earth Engine
// See this very useful tutorial: https://developers.google.com/earth-engine/tutorials/community/ph-ug-temp

// Import UK country boundaries feature collection
var dataset = ee.FeatureCollection('USDOS/LSIB_SIMPLE/2017');

// Apply filter where country name equals United Kingdom to extract the boundaries of the UK
var UKBorder = dataset.filter(ee.Filter.eq('country_na', 'United Kingdom'));
print(UKBorder);

// Add UK outline to the Map as a layer
Map.centerObject(UKBorder, 6);
Map.addLayer(UKBorder);

// Import LST image collection
// See catalog entry for the MODIS dataset: https://developers.google.com/earth-engine/datasets/catalog/MODIS_006_MOD11A2
var modis = ee.ImageCollection('MODIS/006/MOD11A2');

// Define a date range of interest
var start = ee.Date('2020-06-01');
var end = ee.Date('2020-08-31');
var dateRange = ee.DateRange(start, end);

// Filter the LST collection to include only images intersecting the desired date range
var mod11a2 = modis.filterDate(dateRange);

// Select only the 1km day LST data band
var modLSTday = mod11a2.select('LST_Day_1km');

// Scale to Kelvin and convert to Celsius, set image acquisition time
var modLSTc = modLSTday.map(function(img) {
  return img
    .multiply(0.02)
    .subtract(273.15)
    .copyProperties(img, ['system:time_start']);
});

// Chart time series of LST for the specfied period in the UK
var ts1 = ui.Chart.image.series({
  imageCollection: modLSTc,
  region: UKBorder,
  reducer: ee.Reducer.mean(),
  scale: 1000,
  xProperty: 'system:time_start'})
  .setOptions({
     title: 'LST Summer 2020 Time Series',
     vAxis: {title: 'LST Celsius'}});
print(ts1);

// Calculate 8-day mean temperature for UK in summer 2020
var clippedLSTc = modLSTc.mean().clip(UKBorder);

// Add new clipped image layer to the map to visualise temperature data
Map.addLayer(clippedLSTc, {
  min: 10, max: 35,
  palette: ['blue', 'limegreen', 'yellow', 'darkorange', 'red']},
  'Mean temperature, 2020');

// Export the image to your Google Drive account for future analysis
Export.image.toDrive({
  image: clippedLSTc,
  description: 'LST_Celsius_Summer2020',
  folder: 'LST',
  region: UKBorder,
  scale: 1000,
  crs: 'EPSG:4326',
  maxPixels: 1e10});
